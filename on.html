<!DOCTYPE html>
<html lang="nl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>Verkeersongevallen Dashboard</title>

    <!-- ArcGIS SDK CSS -->
    <link rel="stylesheet" href="https://js.arcgis.com/4.33/esri/themes/light/main.css" />
    <script src="https://js.arcgis.com/4.33/"></script>
    <script type="module" src="https://js.arcgis.com/4.33/map-components/"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }
      
      body {
        display: flex;
        height: 100vh;
        overflow: hidden;
        background: white; /* Updated background color */
      }
      
      /* Sidebar styling */
      #sidebar {
        width: 320px;
        background: white; /* Updated sidebar background color */
        color: #1a2a6c; /* Changed text color for readability on white background */
        padding: 20px;
        display: flex;
        flex-direction: column;
        box-shadow: 2px 0 10px rgba(0,0,0,0.2);
        z-index: 1000;
      }
      
      .sidebar-header {
        text-align: center;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 1px solid #ccc; /* Updated border color for visibility */
      }
      
      .sidebar-header h1 {
        font-size: 1.4rem;
        font-weight: 600;
        color: #1a2a6c; /* Ensured header text is dark */
      }
      
      /* Indicator styling */
      #indicator {
        background: #f8f9fa; /* Slightly off-white for contrast */
        border-radius: 10px;
        padding: 20px;
        color: #333;
        text-align: center;
        margin-bottom: 20px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      }
      
      #indicator h3 {
        color: #1a2a6c;
        margin-bottom: 15px;
        font-size: 1.2rem;
      }
      
      .count-display {
        font-size: 42px;
        font-weight: 800;
        color: #e74c3c;
        margin: 10px 0;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
      }
      
      .location {
        font-size: 16px;
        color: #2c3e50;
        margin: 5px 0;
        font-weight: 500;
      }
      
      .trend {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-top: 15px;
        font-weight: 500;
        font-size: 14px;
        padding: 8px 12px;
        border-radius: 20px;
        background: #f8f9fa;
      }
      
      .trend.up {
        color: #e74c3c;
        background: #ffebee;
      }
      
      .trend.down {
        color: #2ecc71;
        background: #e8f5e9;
      }
      
      .trend i {
        margin-right: 5px;
      }
      
      /* Data card styling */
      .data-card {
        background: #f8f9fa; /* Slightly off-white for contrast */
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 15px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      }
      
      .data-card h4 {
        color: #1a2a6c;
        margin-bottom: 10px;
        font-size: 1rem;
      }
      
      .data-item {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid #eee;
      }
      
      .data-item:last-child {
        border-bottom: none;
      }
      
      .data-year {
        font-weight: 500;
      }
      
      .data-value {
        font-weight: 700;
        color: #1a2a6c;
      }
      
      /* Map area styling */
      #map-container {
        flex: 1;
        position: relative;
      }
      
      #viewDiv {
        height: 100%;
        width: 100%;
      }
      
      #filterDiv {
        position: absolute;
        top: 15px;
        right: 15px;
        padding: 15px;
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        z-index: 100;
        width: 200px;
      }
      
      #filterDiv label {
        font-weight: bold;
        display: block;
        margin-bottom: 8px;
        color: #1a2a6c;
      }
      
      #yearSelect {
        width: 100%;
        padding: 10px;
        border-radius: 6px;
        border: 1px solid #ddd;
        font-size: 14px;
        background: #f8f9fa;
        color: #2c3e50;
      }
      
      /* Footer styling */
      .sidebar-footer {
        margin-top: auto;
        padding-top: 15px;
        border-top: 1px solid #ccc; /* Updated border color */
        text-align: center;
        font-size: 12px;
        color: #666; /* Changed text color */
      }
      
      /* Responsive adjustments */
      @media (max-width: 768px) {
        body {
          flex-direction: column;
        }
        
        #sidebar {
          width: 100%;
          height: auto;
          max-height: 40vh;
          overflow-y: auto;
        }
        
        #map-container {
          height: 60vh;
        }
      }
    </style>
  </head>

  <body>
    <!-- Sidebar with indicator -->
    <div id="sidebar">
      <div class="sidebar-header">
        <h1>Verkeersongevallen Dashboard</h1>
      </div>
      
      <!-- Indicator -->
      <div id="indicator">
        <h3>Aantal Verkeersongevallen</h3>
        <div class="count-display" id="aantal">296</div>
        <div class="location" id="locationInfo">Gemeente Den Helder</div>
        <div class="location" id="yearInfo">Jaar: 2024</div>
        <div class="trend down" id="trendIndicator">
          <i class="fas fa-arrow-down"></i> 3% daling t.o.v. vorig jaar
        </div>
      </div>
      
      <!-- Data overview -->
      <div class="data-card">
        <h4>Overzicht per jaar</h4>
        <div class="data-item">
          <span class="data-year">2020</span>
          <span class="data-value">245</span>
        </div>
        <div class="data-item">
          <span class="data-year">2021</span>
          <span class="data-value">274</span>
        </div>
        <div class="data-item">
          <span class="data-year">2022</span>
          <span class="data-value">322</span>
        </div>
        <div class="data-item">
          <span class="data-year">2023</span>
          <span class="data-value">305</span>
        </div>
        <div class="data-item">
          <span class="data-year">2024</span>
          <span class="data-value">296</span>
        </div>
      </div>
      
      <!-- Stats card -->
      <div class="data-card">
        <h4>Statistieken</h4>
        <div class="data-item">
          <span>Gemiddeld per jaar</span>
          <span class="data-value">288</span>
        </div>
        <div class="data-item">
          <span>Hoogste aantal</span>
          <span class="data-value">322 (2022)</span>
        </div>
        <div class="data-item">
          <span>Laagste aantal</span>
          <span class="data-value">245 (2020)</span>
        </div>
      </div>
      
      <div class="sidebar-footer">
        <p>  &copy; 2024<br>De data in deze laag is afkomstig van het Bestand geRegistreerde Ongevallen Nederland (BRON).</p>
      </div>
    </div>

    <!-- Map container -->
    <div id="map-container">
      <div id="viewDiv"></div>

      <!-- Filter rechtsboven -->
      <div id="filterDiv" class="esri-widget">
        <label for="yearSelect">Filter op Jaar</label>
        <select id="yearSelect">
          <option value="2020">2020</option>
          <option value="2021">2021</option>
          <option value="2022">2022</option>
          <option value="2023">2023</option>
          <option value="2024" selected>2024</option>
        </select>
      </div>
    </div>

    <script type="module">
      const [WebMap, MapView, BasemapToggle, Legend, Expand] = await $arcgis.import([
        "@arcgis/core/WebMap.js",
        "@arcgis/core/views/MapView.js",
        "@arcgis/core/widgets/BasemapToggle.js",
        "@arcgis/core/widgets/Legend.js",
        "@arcgis/core/widgets/Expand.js"
      ]);

      // Webmap laden
      const webmap = new WebMap({
        portalItem: {
          id: "8882e867dc9c403798d9c7a46d8b0008"
        }
      });

      const view = new MapView({
        container: "viewDiv",
        map: webmap
      });

      await view.when();

      // Widgets toevoegen
      view.ui.add(new BasemapToggle({ view, nextBasemap: "satellite" }), "bottom-right");
      view.ui.add(new Expand({ view, content: new Legend({ view }), expandTooltip: "Legenda" }), "bottom-left");
      view.ui.add("filterDiv", "top-right");

      // Data for Den Helder
      const accidentData = {
        '2020': 245,
        '2021': 274,
        '2022': 322,
        '2023': 305,
        '2024': 296
      };
      
      // Get DOM elements
      const yearSelect = document.getElementById('yearSelect');
      const accidentCount = document.getElementById('aantal');
      const yearInfo = document.getElementById('yearInfo');
      const trendIndicator = document.getElementById('trendIndicator');
      
      // Update indicator based on selected year
      function updateIndicator(year) {
        // Update the count
        accidentCount.textContent = accidentData[year];
        
        // Update year info
        yearInfo.textContent = `Jaar: ${year}`;
        
        // Calculate and display trend
        const currentYear = parseInt(year);
        const prevYear = (currentYear - 1).toString();
        
        if (accidentData[prevYear]) {
          const difference = accidentData[year] - accidentData[prevYear];
          const percentage = ((difference / accidentData[prevYear]) * 100).toFixed(1);
          
          if (difference > 0) {
            trendIndicator.innerHTML = `<i class="fas fa-arrow-up"></i> +${Math.abs(percentage)}% stijging t.o.v. vorig jaar`;
            trendIndicator.className = 'trend up';
          } else if (difference < 0) {
            trendIndicator.innerHTML = `<i class="fas fa-arrow-down"></i> ${Math.abs(percentage)}% daling t.o.v. vorig jaar`;
            trendIndicator.className = 'trend down';
          } else {
            trendIndicator.innerHTML = `<i class="fas fa-equals"></i> Gelijk aan vorig jaar`;
            trendIndicator.className = 'trend';
          }
        } else {
          trendIndicator.innerHTML = ``;
        }
      }

      // Filter logica
      const featureLayers = webmap.layers.items.filter(l => l.type === "feature");

      function applyYearFilter(year) {
        featureLayers.forEach(layer => {
          layer.definitionExpression = `JAAR_VKL = ${year}`;
        });
        
        // Update the indicator
        updateIndicator(year);
      }

      // Standaard filter = 2024
      applyYearFilter(2024);

      // Op dropdown wijziging
      document.getElementById("yearSelect").addEventListener("change", (event) => {
        applyYearFilter(event.target.value);
      });
    </script>
  </body>
</html>
